<include file="Public:march_left"/>
            <div id="match_info">
                <table class="list">
                    <tbody>
                    <volist name="item" id="vo">
                        <tr>
                        <th colspan="6">
                        <?php
                        if(strtotime($key) == strtotime(date('Y-m-d', time()))-86400){
                            $day = "昨天";
                        }elseif(strtotime($key) == strtotime(date('Y-m-d', time()))){
                            $day = "今天";
                        }elseif(strtotime($key) == strtotime(date('Y-m-d', time()))+86400){
                            $day = "明天";
                        }else{
                            $weekday = array('周日','周一','周二','周三','周四','周五','周六'); 
                            $day = $weekday[date('w', strtotime($key))];
                        }
                        ?>
                       {$key} {$day}
                        </th>
                        </tr>
                        <volist name="vo" id="v">
                            <tr rel="2388735" id="match_2388735" class="matchItem">
                                
                                <td class="times">
                                <?php
                                
                                
                                    if($v['start_time'] > time()){
                                       $state = substr(date("Y-m-d H:i:s",$v['start_time']),-8,5);
                                       $score = "--";
                                    }elseif(($v['start_time']<= time()) AND ($v['start_time'] >(time() - 6300))){
                                        $state = '比赛进行中';
                                        $score = $v['hometeam_score'].':'.$v['vsitingteam_score'];
                                    }else{
                                        $state = '完场';
                                        $score = $v['hometeam_score'].':'.$v['vsitingteam_score'];
                                    }
                                ?>{$state}
                                </td>
                                <td class="round">
                                {$v.level}
                                </td>
                                <td class="away">
                                <img src="{$v.hometeam.icon}">
                                {$v.hometeam.name}
                                </td>
                                <td class="stat">{$score}</td>
                                <td class="home">
                                {$v.vsitingteam.name}
                                <img src="{$v.vsitingteam.icon}" >
                                </td>
                                <td class="link">
                                    <a href="{$v.video_url}" target="_blank">{$v.lick_name}</a>&nbsp;
                                </td>
                            </tr>
                        </volist>
                    </volist>
                        <!-- <tr>
                            <th colspan="6">2017-01-14 今天</th>
                        </tr>
                        <tr rel="2283077" id="match_2283077" class="matchItem">
                            <td class="times">20:00</td>
                            <td class="round">
                            西甲
                            </td>
                            <td class="away">
                            <img src="__PUBLIC__/image/march/2053.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            莱加内斯
                            </td>
                            <td class="vs">VS</td>
                            <td class="home">
                            毕尔巴鄂竞技
                            <img src="__PUBLIC__/image/march/2019.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            </td>
                            <td class="link">
                            <a href="http://v.pptv.com/show/rUyrKZH3Z6WSJY70ZA.html?rcc_id=wap_dongqiudi" target="_blank">PPTV(北京西甲1)</a>&nbsp;
                            </td>
                        </tr>
                        <tr>
                            <th colspan="6">2017-01-15 明天</th>
                        </tr>
                        <tr rel="2366078" id="match_2366078" class="matchItem">
                            <td class="times">00:00</td>
                            <td class="round">
                            非洲杯
                            </td>
                            <td class="away">
                            <img src="__PUBLIC__/image/march/945.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            加蓬
                            </td>
                            <td class="vs">VS</td>
                            <td class="home">
                            几内亚比绍
                            <img src="__PUBLIC__/image/march/1096.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            </td>
                            <td class="link">
                            </td>
                        </tr>
                        <tr>
                            <th colspan="6">2017-01-16 周一</th>
                        </tr>

                        <tr rel="2237105" id="match_2237105" class="matchItem">
                            <td class="times">00:00</td>

                            <td class="round">
                            法甲
                            </td>

                            <td class="away">
                            <img src="__PUBLIC__/image/march/902.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            卡昂
                            </td>

                            <td class="vs">VS</td>

                            <td class="home">
                            里昂
                            <img src="__PUBLIC__/image/march/884.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            </td>

                            <td class="link">
                            </td>
                        </tr>
                        <tr>
                            <th colspan="6">2017-01-17 周二</th>
                        </tr>

                        <tr rel="2366095" id="match_2366095" class="matchItem">
                            <td class="times">00:00</td>
                            <td class="round">
                            非洲杯
                            </td>
                            <td class="away">
                            <img src="__PUBLIC__/image/march/598.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            科特迪瓦
                            </td>
                            <td class="vs">VS</td>

                            <td class="home">
                            多哥
                            <img src="__PUBLIC__/image/march/2208.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            </td>

                            <td class="link">
                            </td>
                        </tr>
                        <tr>
                            <th colspan="6">2017-01-18 周三</th>
                        </tr>
                        <tr rel="2366101" id="match_2366101" class="matchItem">
                            <td class="times">00:00</td>
                            <td class="round">
                            非洲杯
                            </td>
                            <td class="away">
                            <img src="__PUBLIC__/image/march/1038.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            加纳
                            </td>
                            <td class="vs">VS</td>
                            <td class="home">
                            乌干达
                            <img src="__PUBLIC__/image/march/2252.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            </td>
                            <td class="link">
                            </td>
                        </tr>
                        <tr>
                            <th colspan="6">2017-01-19 周四</th>
                        </tr>
                        <tr rel="2366080" id="match_2366080" class="matchItem">
                            <td class="times">00:00</td>
                            <td class="round">
                            非洲杯
                            </td>
                            <td class="away">
                            <img src="__PUBLIC__/image/march/945.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            加蓬
                            </td>
                            <td class="vs">VS</td>
                            <td class="home">
                            布基纳法索
                            <img src="__PUBLIC__/image/march/383.png" onerror="this.src=&#39;http://static1.dongqiudi.com/web-new/web/images/defaultTeam.png&#39;">
                            </td>
                            <td class="link">
                            </td>
                        </tr>  -->
                    </tbody>
                </table>
            </div>
        <div class="loading" style="visibility: hidden;"><span class="load"></span> 正在加载...</div>
    </div>
</div>

<script type="text/javascript" src="__PUBLIC__/js/march/zebra_datepicker.js"></script>
    <script>
        Date.prototype.format = function (format) {
            var o = {
                "M+": this.getMonth() + 1, //month
                "d+": this.getDate(), //day
                "h+": this.getHours(), //hour
                "m+": this.getMinutes(), //minute
                "s+": this.getSeconds(), //second
                "q+": Math.floor((this.getMonth() + 3) / 3), //quarter
                "S": this.getMilliseconds() //millisecond
            }
            if (/(y+)/.test(format)) format = format.replace(RegExp.$1,
                    (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)if (new RegExp("(" + k + ")").test(format))
                format = format.replace(RegExp.$1,
                        RegExp.$1.length == 1 ? o[k] :
                                ("00" + o[k]).substr(("" + o[k]).length));
            return format;
        };

        var scroll_locked = false;
        var scroll_times = 0;
        var next_date = (new Date).format("yyyy-MM-dd");
        var tz = (new Date()).getTimezoneOffset() / 60;
        var times = 1;

        function getTabMatch(date) {
            $('.loading').css({visibility: 'visible'});
            var tab = getUrlParam('tab');
            url = "/match/fetch?tab=" + tab + "&date=" + date + "&scroll_times=" + scroll_times + "&tz=" + tz;
            $.ajax({
                url: url,
                success: function (data) {
                    if (data.errCode) {
                        scroll_locked = false;
                        $('.loading').css({visibility: 'hidden'});
                        return;
                    }
                    if (data) {

                        if (data.html == "") {
                            blinkShow("近期没有更多比赛");
                        }

                        if (scroll_times == 0) {
                            $('#match_info').html(data.html);
                        } else {
                            $('#match_info').append(data.html);
                        }

                        next_date = data.next_date;
                        scroll_times++;
                        scroll_locked = false;
                    }
                    $('.loading').css({visibility: 'hidden'});
                }
            });
        }

        getTabMatch(next_date);

        $(function () {
            $('.list').delegate('span.more', 'mouseenter', function () {
                $(this).closest('td').find('.more_list').show();
            });
            $('.list').delegate('td.link', 'mouseleave', function () {
                $(this).find('.more_list').hide();
            })

            $('#date_input').DatePicker({
                onSelect: function () {
                    scroll_locked = true;
                    scroll_times = 1;
                    next_date = this[0].value;
                    $('#match_info').empty();
                    getTabMatch(next_date);
                }
            });
            $(document).scroll(function () {
                window.setTimeout(function () {
                    if (!scroll_locked && scroll_times > 0) {
                        var allHeight = document.body.scrollHeight;
                        var sHeight = document.documentElement.scrollTop || document.body.scrollTop;
                        var winHeight = document.documentElement.clientHeight;
                        var margin = allHeight - sHeight - winHeight;

                        if (margin < 1000) {
                            scroll_locked = true;
                            getTabMatch(next_date);
                        }
                    }
                }, 2000)
            });
            $('#match_info').delegate('span.more', 'mouseenter', function () {
                $(this).closest('td').find('.more_list').show()
            }).delegate('td.link', 'mouseleave', function () {
                $(this).find('.more_list').hide()
            }).delegate('.more_list', 'mouseleave', function () {
                $(this).hide()
            })

        });

        window.setInterval(function () {
            updateMatches();
        }, 15000);

        function updateMatches() {
            var i = $('#match_info').find('tr.matchItem').length;
            var match_ids = [];
            for (var q = 0; q < i; q++) {
                var item = $('#match_info tr.matchItem').eq(q);
                if (item.find('td').eq(0).text() != '完场') {
                    match_ids.push(item.attr('rel'))
                }
            }

            if (match_ids.length > 0) {
                $.ajax({
                    url: '/match/query',
                    type: 'POST',
                    data: {'ids': match_ids, 'times':times},
                    success: function (data) {
                        for (i in data) {
                            var match = data[i];
                            var id = match.match_id;
                            if (match.status == 'Playing') {
                                var time = match.minute;
                                if (!match.minute) {
                                    time = 0;
                                }
                                var playing_status = "<i>" + time + "' 直播中</i>";
                                $('#match_' + id).find('td').eq(0).html(playing_status);
                                $('#match_' + id).find('td').eq(3).addClass(" live");
                            }
                            else if (match.status == 'Played') {
                                $('#match_' + id).find('td').eq(0).html("完场");
                                $('#match_' + id).find('td').eq(3).removeClass('live');
                            }
                            $('#match_' + id).find('td').eq(3).html(match.result);
                        }
                    }
                });

                times++;
            }
        }

        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }
    </script>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?662abe3e1ab2558f09503989c9076934";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<div class="Zebra_DatePicker" style="left: -1000px; display: none;">
	<table class="dp_header" style="width: 218px;">
		<tbody><tr><td class="dp_previous">?</td><td class="dp_caption">F, Y</td><td class="dp_next">?</td></tr></tbody>
	</table>
	<table class="dp_daypicker">
		<tbody>
			<tr>	
				<th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th><th>日</th>
			</tr>
			<tr>
				<td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td class="dp_weekend">NaN</td><td class="dp_weekend">NaN</td>
			</tr>
			<tr>
				<td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td class="dp_weekend">NaN</td><td class="dp_weekend">NaN</td>
			</tr>
			<tr>
				<td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td class="dp_weekend">NaN</td><td class="dp_weekend">NaN</td>
			</tr>
			<tr>
				<td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td class="dp_weekend">NaN</td><td class="dp_weekend">NaN</td>
			</tr>
			<tr>
				<td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td class="dp_weekend">NaN</td><td class="dp_weekend">NaN</td>
			</tr>
			<tr>
				<td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td class="dp_weekend">NaN</td><td class="dp_weekend">NaN</td>
			</tr>
		</tbody>
	</table>
	<table class="dp_monthpicker" style="width: 218px; height: 190px; display: none;"></table>
	<table class="dp_yearpicker" style="width: 218px; height: 190px; display: none;"></table>
	<table class="dp_footer" style="width: 218px;">
		<tbody>
			<tr><td class="dp_today" style="width: 100%;">今天</td><td class="dp_clear" style="width: 50%; display: none;">清空</td></tr>
		</tbody>
	</table>
</div>
<include file="Public:footer" />